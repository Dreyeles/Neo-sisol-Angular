<div class="dashboard doctor-dashboard">
  <!-- Sidebar -->
  <aside class="dashboard-sidebar">
    <div class="sidebar-brand">
      <div class="brand-logo">
        <span class="logo-text">SISOL<span class="logo-sub">SALUD</span></span>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <button class="nav-item" [class.active]="activeSection === 'agenda'" (click)="setActiveSection('agenda')">
        <span class="nav-icon">ğŸ“…</span> Mi Agenda
      </button>
      <button class="nav-item" [class.active]="activeSection === 'pacientes'" (click)="setActiveSection('pacientes')">
        <span class="nav-icon">ğŸ‘¥</span> Mis Pacientes
      </button>
      <button class="nav-item" [class.active]="activeSection === 'historial'" (click)="setActiveSection('historial')">
        <span class="nav-icon">ğŸ“‹</span> Historial MÃ©dico
      </button>
      <button class="nav-item" [class.active]="activeSection === 'perfil'" (click)="setActiveSection('perfil')">
        <span class="nav-icon">ğŸ‘¤</span> Mi Perfil
      </button>
    </nav>

    <div class="sidebar-spacer"></div>

    <div class="sidebar-footer">
      <button class="btn-logout" (click)="onLogout()">
        <span class="logout-icon">â†ª</span> Cerrar SesiÃ³n
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="dashboard-content">
    <header class="dashboard-top-header">
      <div class="welcome-text">
        <h1>Bienvenido, Dr. {{ user?.nombre || 'Beatriz' }}</h1>
        <p class="subtitle">Panel MÃ©dico</p>
      </div>
    </header>

    <main class="dashboard-main-area">
      <!-- Agenda Section -->
      <section *ngIf="activeSection === 'agenda'" class="agenda-section">
        <h2 class="section-title">Agenda del DÃ­a</h2>
        
        <div class="appointments-container">
          <div *ngIf="loadingCitas" class="loading-state">Cargando agenda...</div>
          
          <div *ngIf="!loadingCitas && citas.length === 0" class="empty-agenda">
            <p>No tienes citas programadas para hoy</p>
          </div>

          <div *ngFor="let cita of citas" class="appointment-card">
            <div class="appointment-details">
              <h3 class="patient-name">Paciente: {{ cita.paciente_nombre }} {{ cita.paciente_apellido }}</h3>
              <p class="appointment-reason">Motivo: {{ cita.motivo_consulta }}</p>
              <div class="appointment-meta">
                <span class="meta-item"><span class="meta-icon">ğŸ—“ï¸</span> {{ cita.fecha_cita | date:'dd \'de\' MMMM \'de\' yyyy' }}</span>
                <span class="meta-item"><span class="meta-icon">ğŸ•’</span> {{ cita.hora_cita }}</span>
              </div>
              <span class="status-badge" [ngClass]="cita.estado">{{ cita.estado }}</span>
            </div>
            
            <div class="appointment-actions">
              <button class="btn-action btn-start" (click)="handleIniciarConsulta(cita)">Iniciar Consulta</button>
              <button class="btn-action btn-history" (click)="activeSection = 'pacientes'">Ver Historia</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Mis Pacientes Section -->
      <section *ngIf="activeSection === 'pacientes'" class="patients-section">
        <h2 class="section-title">Mis Pacientes Atendidos</h2>
        
        <div class="patients-grid">
          <div *ngIf="loadingPacientes" class="loading-state">Cargando pacientes...</div>
          
          <div *ngFor="let pte of pacientes" class="patient-card">
            <div class="patient-profile">
              <div class="profile-icon">
                <svg viewBox="0 0 24 24" class="user-svg">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              </div>
            </div>

            <div class="patient-info">
              <h3 class="patient-card-name">{{ pte.nombres }}<br>{{ pte.apellidos }}</h3>
              <div class="patient-meta-details">
                <p class="meta-row"><span class="label">DNI:</span> <span class="value">{{ pte.dni }}</span></p>
                <p class="meta-row"><span class="label">Ãšltima visita:</span> <span class="value">{{ pte.ultima_cita | date:'dd/MM/yyyy' }}</span></p>
              </div>
            </div>

            <div class="patient-actions">
              <button class="btn-view-medical" (click)="handleIniciarConsulta(pte)">
                Ver AtenciÃ³n MÃ©dica
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Perfil Section -->
      <div *ngIf="activeSection === 'perfil'" class="section-content">
        <div class="perfil-card">
          <div class="perfil-header">
            <div class="avatar">ğŸ‘¨â€âš•ï¸</div>
            <h3>Dr. {{ user?.nombre }} {{ user?.apellidos }}</h3>
            <p>{{ especialidadNombre }}</p>
          </div>
          <div class="perfil-info">
            <div class="info-item"><label>Email:</label><span>{{ user?.email }}</span></div>
            <div class="info-item"><label>Especialidad:</label><span>{{ especialidadNombre }}</span></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal de Consulta (Simplified) -->
  <div class="payment-modal-overlay" *ngIf="showConsultaModal" (click)="showConsultaModal = false">
    <div class="payment-modal consulta-modal" (click)="$event.stopPropagation()">
      <div class="payment-modal-header">
        <h3>ğŸ©º Consulta MÃ©dica - {{ consultaActual?.paciente_nombre }}</h3>
        <button class="close-modal" (click)="showConsultaModal = false">âœ•</button>
      </div>
      <div class="payment-modal-body">
         <div class="consulta-steps">
            <button (click)="consultaStep = 1" [class.active]="consultaStep === 1">1. Triaje</button>
            <button (click)="consultaStep = 2" [class.active]="consultaStep === 2">2. Consulta</button>
            <button (click)="consultaStep = 3" [class.active]="consultaStep === 3">3. Receta</button>
         </div>

         <div *ngIf="consultaStep === 1">
            <div class="form-row">
              <div class="form-group"><label>Peso (kg)</label><input type="text" [(ngModel)]="consultaForm.peso" name="peso" /></div>
              <div class="form-group"><label>Talla (cm)</label><input type="text" [(ngModel)]="consultaForm.talla" name="talla" /></div>
            </div>
            <div class="form-row">
              <div class="form-group"><label>PresiÃ³n</label><input type="text" [(ngModel)]="consultaForm.presion_arterial" name="presion" /></div>
              <div class="form-group"><label>Temp (Â°C)</label><input type="text" [(ngModel)]="consultaForm.temperatura" name="temp" /></div>
            </div>
         </div>

         <div *ngIf="consultaStep === 2">
            <div class="form-group"><label>SÃ­ntomas</label><textarea [(ngModel)]="consultaForm.sintomas" name="sintomas"></textarea></div>
            <div class="form-group">
               <label>DiagnÃ³stico</label>
               <div style="display: flex; gap: 10px;">
                  <input type="text" [(ngModel)]="nuevoDiagnostico" name="nDiag" (keyup.enter)="handleAgregarDiagnostico()" />
                  <button type="button" (click)="handleAgregarDiagnostico()" class="btn-primary">+</button>
               </div>
               <ul><li *ngFor="let d of diagnosticosList">{{ d }}</li></ul>
            </div>
         </div>

         <div *ngIf="consultaStep === 3">
            <div class="form-group">
               <label>Medicamentos</label>
               <input type="text" [(ngModel)]="nuevoMedicamento.nombre" placeholder="Nombre" />
               <input type="text" [(ngModel)]="nuevoMedicamento.dosis" placeholder="Dosis" />
               <button type="button" (click)="handleAgregarMedicamento()" class="btn-primary">AÃ±adir</button>
               <ul><li *ngFor="let m of medicamentosList">{{ m.nombre }} - {{ m.dosis }}</li></ul>
            </div>
         </div>
      </div>
      <div class="payment-modal-footer">
        <button class="btn-secondary" (click)="showConsultaModal = false">Cerrar</button>
        <button class="btn-primary" (click)="handleSubmitConsulta()">Guardar Consulta</button>
      </div>
    </div>
  </div>
</div>
